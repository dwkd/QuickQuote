var StockGenerator={init:function(){this.CreateTickersContainer();this.CreateTickerInputContainer();this.GetStocks(this.GetLocalTickers());},GetLocalTickers:function(){var c=["GOOG","EVHC","YHOO","AAPL","FB","MMM"],a=[],b="";if(typeof localStorage.LocalTickers=="undefined"){localStorage.LocalTickers=JSON.stringify(c);}a=JSON.parse(localStorage.LocalTickers);return a;},AddLocalTicker:function(a){LocalTickers=JSON.parse(localStorage.LocalTickers);if(LocalTickers.indexOf(a)==-1){LocalTickers.push(a);localStorage.LocalTickers=JSON.stringify(LocalTickers);this.DestroyTickersContainer();this.GetStocks(this.GetLocalTickers());}},RemoveLocalTicker:function(a){LocalTickers=JSON.parse(localStorage.LocalTickers);i=LocalTickers.indexOf(a);if(i!=-1){LocalTickers.splice(i,1);localStorage.LocalTickers=JSON.stringify(LocalTickers);}},GetStocks:function(a){for(i in a){this.GetStock(a[i]);}},GetStock:function(c){var a="http://dev.markitondemand.com/Api/Quote/jsonp?symbol="+c;var b=new XMLHttpRequest();b.open("GET",a);b.onload=function(f){var d=f.currentTarget.responseText.split("(function () { })(")[1];d=d.slice(0,d.length-1);StockGenerator.AddTickerToContainer(d);};b.send(null);},CreateTickersContainer:function(){var a=document.createElement("div");a.id="TickersContainer";document.body.appendChild(a);},AddTickerToContainer:function(c){var e=document.getElementById("TickersContainer");o=JSON.parse(c);q=o.Data;var f=document.createElement("div");f.className="QuoteItem";f.setAttribute("ticker",q.Symbol);f.appendChild(this.CreateDOMElement("div","ticker",q.Symbol));f.appendChild(this.CreateDOMElement("div","LastTradePrice",q.LastPrice.toFixed(2)));var b="ChangeInPercent";if(parseFloat(q.ChangePercent.toFixed(3))==0){b+=" gray";}else{if(parseFloat(q.ChangePercent.toFixed(3))>0){b+=" green";}else{b+=" red";}}var d=((q.Change.toFixed(3)>0&&q.Change.toFixed(3)<0.01)||(q.Change.toFixed(3)<0&&q.Change.toFixed(3)>-0.01)?q.Change.toFixed(3):q.Change.toFixed(2));var g=((q.ChangePercent.toFixed(3)>0&&q.ChangePercent.toFixed(3)<0.01)||(q.ChangePercent.toFixed(3)<0&&q.ChangePercent.toFixed(3)>-0.01)?q.ChangePercent.toFixed(3):q.ChangePercent.toFixed(2));f.appendChild(this.CreateDOMElement("div",b,(parseFloat(g)>0?"+":"")+d+" ( "+(parseFloat(g)>0?"+":"")+g+"% ) "));var a=this.CreateDOMElement("img");a.setAttribute("ticker",q.Symbol);a.src="icon_remove.png";a.width=15;a.onclick=function(){this.parentNode.parentNode.parentNode.removeChild(this.parentNode.parentNode);StockGenerator.RemoveLocalTicker(this.getAttribute("ticker"));};var h=this.CreateDOMElement("div","cancel");h.appendChild(a);f.appendChild(h);e.appendChild(f);StockGenerator.SortTickersContainer();},SortTickersContainer:function(){var a=document.getElementById("TickersContainer");var c=a.childNodes;var b=[];for(i in c){if(c[i].nodeType==1){b.push(c[i]);}}b.sort(function(e,d){return e.innerHTML==d.innerHTML?0:(e.innerHTML>d.innerHTML?1:-1);});for(i in b){a.appendChild(b[i]);}},DestroyTickersContainer:function(){document.body.removeChild(document.getElementById("TickersContainer"));
},CreateTickerInputContainer:function(){var c=StockGenerator.CreateDOMElement("div","TickerInputContainer");var b=StockGenerator.CreateDOMElement("input","TickerInput");b.value="Search or Get Quote";var a=StockGenerator.CreateDOMElement("img","AddButton");a.src="icon_add.png";b.onfocus=function(){this.value=this.value=="Search or Get Quote"?"":this.value;};b.onblur=function(){if(this.value==""){this.value="Search or Get Quote";StockGenerator.DestroyTypeAhead();}};b.onkeyup=function(){var d=new XMLHttpRequest();d.open("GET","http://dev.markitondemand.com/Api/Lookup/jsonp?input="+this.value);d.onload=function(g){var f=g.currentTarget.responseText.split("(function () { })(")[1];f=f.slice(0,f.length-1);StockGenerator.ShowTypeAhead(JSON.parse(f)[0]);};d.send(null);};c.appendChild(b);c.appendChild(a);document.body.appendChild(c);},ShowTypeAhead:function(c){var b=StockGenerator.CreateDOMElement("div","TypeAheadContainer");b.id="TypeAheadDiv";var a=StockGenerator.CreateDOMElement("div","TypeAheadCompanyName");a.innerHTML=c.Name.substr(0,23)+(c.Name.length>23?"...":"");var d=StockGenerator.CreateDOMElement("div","TypeAheadTickerValue");d.innerHTML=c.Symbol;b.appendChild(a);b.appendChild(d);document.getElementById("TickersContainer").appendChild(b);},DestroyTypeAhead:function(){var a=document.getElementById("TypeAheadDiv");document.getElementById("TickersContainer").removeChild(a);},CreateDOMElement:function(a,c,b){var d=document.createElement(a);if(typeof c!="undefined"){d.className=c;}if(typeof b!="undefined"){d.innerHTML=b;}return d;}};document.addEventListener("DOMContentLoaded",function(){StockGenerator.init();});