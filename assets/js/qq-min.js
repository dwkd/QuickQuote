var StockGenerator={init:function(){StockGenerator.CreateTickersContainer();StockGenerator.CreateTickerInputContainer();StockGenerator.GetStocks(StockGenerator.GetLocalTickers());StockGenerator.CreateInfoIcon();var a=setInterval(function(){StockGenerator.GetStocks(StockGenerator.GetLocalTickers());},10000);},GetLocalTickers:function(){var c=["GOOG","YHOO","AAPL","FB","EVHC"],a=[],b="";if(typeof localStorage.LocalTickers=="undefined"){localStorage.LocalTickers=JSON.stringify(c);}a=JSON.parse(localStorage.LocalTickers);return a;},AddLocalTicker:function(b){LocalTickers=JSON.parse(localStorage.LocalTickers);if(LocalTickers.indexOf(b)==-1){LocalTickers.push(b);localStorage.LocalTickers=JSON.stringify(LocalTickers);StockGenerator.GetStock(b,true);}else{var a=document.getElementById("ticker_"+b);a.classList.remove("bgFade");setTimeout(function(){a.classList.add("bgFade");},1);}StockGenerator.DestroyTickerInputContainer();StockGenerator.CreateTickerInputContainer();},RemoveLocalTicker:function(a){LocalTickers=JSON.parse(localStorage.LocalTickers);i=LocalTickers.indexOf(a);if(i!=-1){LocalTickers.splice(i,1);localStorage.LocalTickers=JSON.stringify(LocalTickers);}},RefreshLocalTickers:function(){var a=StockGenerator.GetLocalTickers();},GetStocks:function(a){for(i in a){StockGenerator.GetStock(a[i],false);}},GetStock:function(d,b){if(d=="Search or Get Quote"){StockGenerator.LoadMoreInfoPopover("Invalid ticker");}else{var a="http://dev.markitondemand.com/Api/Quote/jsonp?symbol="+d;var c=new XMLHttpRequest();c.open("GET",a);c.onload=function(g){var f=g.currentTarget.responseText.split("(function () { })(")[1];f=f.slice(0,f.length-1);if(typeof JSON.parse(f).Message=="undefined"){StockGenerator.AddTickerToContainer(f,b);}else{StockGenerator.RemoveLocalTicker(d);StockGenerator.LoadMoreInfoPopover("Invalid ticker: "+d);}};c.send(null);}},CreateMarketTimeAndLastUpdatedContainer:function(){var a=new XMLHttpRequest();a.open("GET","http://www.timeapi.org/utc/now?format=%25b%20%25d,%20%25Y%20%25I:%25M:%25S");a.onload=function(b){};a.send(null);},CreateTickersContainer:function(){var a=document.createElement("div");a.id="TickersContainer";document.body.appendChild(a);},AddTickerToContainer:function(c,h){var b=document.getElementById("TickersContainer");var a=JSON.parse(c).Data;if(document.getElementById("ticker_"+a.Symbol)){document.getElementById("ticker_"+a.Symbol).parentNode.removeChild(document.getElementById("ticker_"+a.Symbol));h=true;}else{StockGenerator.RemoveTickersFade();}var f=document.createElement("div");f.className="QuoteItem"+(h?" bgFade":"");f.setAttribute("ticker",a.Symbol);f.id="ticker_"+a.Symbol;f.appendChild(this.CreateDOMElement("div","ticker",a.Symbol));f.appendChild(this.CreateDOMElement("div","LastTradePrice",a.LastPrice.toFixed(2)));var j="ChangeInPercent";if(parseFloat(a.ChangePercent.toFixed(3))==0){j+=" gray";}else{if(parseFloat(a.ChangePercent.toFixed(3))>0){j+=" green";}else{j+=" red";}}var g=((a.Change.toFixed(3)>0&&a.Change.toFixed(3)<0.01)||(a.Change.toFixed(3)<0&&a.Change.toFixed(3)>-0.01)?a.Change.toFixed(3):a.Change.toFixed(2));
var d=((a.ChangePercent.toFixed(3)>0&&a.ChangePercent.toFixed(3)<0.01)||(a.ChangePercent.toFixed(3)<0&&a.ChangePercent.toFixed(3)>-0.01)?a.ChangePercent.toFixed(3):a.ChangePercent.toFixed(2));f.appendChild(this.CreateDOMElement("div",j,(parseFloat(d)>0?"+":"")+g+" ( "+(parseFloat(d)>0?"+":"")+d+"% ) "));var e=this.CreateDOMElement("img");e.setAttribute("ticker",a.Symbol);e.src="/assets/images/icon_remove.png";e.width=15;e.onclick=function(){this.parentNode.parentNode.parentNode.removeChild(this.parentNode.parentNode);StockGenerator.RemoveLocalTicker(this.getAttribute("ticker"));};var k=this.CreateDOMElement("div","cancel");k.appendChild(e);f.appendChild(k);b.appendChild(f);StockGenerator.SortTickersContainer();},SortTickersContainer:function(){var a=document.getElementById("TickersContainer");var c=a.childNodes;var b=[];for(i in c){if(c[i].nodeType==1){b.push(c[i]);}}b.sort(function(e,d){return e.innerHTML==d.innerHTML?0:(e.innerHTML>d.innerHTML?1:-1);});for(i in b){a.appendChild(b[i]);}},RemoveTickersFade:function(){var a=document.getElementById("TickersContainer");var b=a.childNodes;for(i in b){if(b[i].nodeType==1){b[i].classList.remove("bgFade");}}},DestroyTickersContainer:function(){document.body.removeChild(document.getElementById("TickersContainer"));},CreateTickerInputContainer:function(){var c=StockGenerator.CreateDOMElement("div","TickerInputContainer");c.id="TickerInputContainer";var b=StockGenerator.CreateDOMElement("input","TickerInput");b.value="Search or Get Quote";b.id="TickerInput";var a=StockGenerator.CreateDOMElement("img","AddButton");a.src="/assets/images/icon_add.png";a.onclick=function(){StockGenerator.AddLocalTicker(b.value);};b.onfocus=function(){this.value=this.value=="Search or Get Quote"?"":this.value;};b.onblur=function(){if(this.value==""){this.value="Search or Get Quote";StockGenerator.DestroyTickerInputContainer();StockGenerator.CreateTickerInputContainer();}};b.onkeyup=function(){if(this.value!=""){this.style.background="url('/assets/images/bg_loading.gif') right top no-repeat";var d=new XMLHttpRequest();d.open("GET","http://dev.markitondemand.com/Api/Lookup/jsonp?input="+this.value);d.onload=function(g){var f=g.currentTarget.responseText.split("(function () { })(")[1];f=f.slice(0,f.length-1);StockGenerator.ShowTypeAhead(JSON.parse(f)[0]);document.getElementById("TickerInput").style.background="";};d.send(null);}};c.appendChild(b);c.appendChild(a);document.body.appendChild(c);},DestroyTickerInputContainer:function(){document.body.removeChild(document.getElementById("TickerInputContainer"));},ShowTypeAhead:function(c){var b=StockGenerator.CreateDOMElement("div","TypeAheadContainer");var a=StockGenerator.CreateDOMElement("div","TypeAheadCompanyName");var d=StockGenerator.CreateDOMElement("div","TypeAheadTickerValue");b.id="TypeAheadDiv";if(typeof c!="undefined"){b.onclick=function(){StockGenerator.AddLocalTicker(c.Symbol);};a.innerHTML=c.Name.substr(0,23)+(c.Name.length>23?"...":"");d.innerHTML=c.Symbol;}else{a.innerHTML="Invalid Company Name or Ticker";
a.style.fontStyle="italic";a.style.color="red";a.style.width="200px";d.style.width="10px";}b.appendChild(a);b.appendChild(d);document.getElementById("TickerInputContainer").appendChild(b);},DestroyTypeAhead:function(){var a=document.getElementById("TypeAheadDiv");document.getElementById("TickerInputContainer").removeChild(a);},CreateInfoIcon:function(){var a=StockGenerator.CreateDOMElement("div","InfoIcon");var b=StockGenerator.CreateDOMElement("img");b.src="/assets/images/icon_info.png";b.onclick=function(){StockGenerator.LoadMoreInfoPopover('Created by Dwkd\'s ChromeLabs@TBP<br> <a href="http://www.TheBluePipe.com" target="_blank">www.TheBluePipe.com</a> <div class="git" ><iframe src="http://ghbtns.com/github-btn.html?user=dwkd&repo=QuickQuote&type=fork" allowtransparency="true" frameborder="0" scrolling="0" width="60" height="20"></iframe> <iframe src="http://ghbtns.com/github-btn.html?user=dwkd&repo=QuickQuote&type=follow" allowtransparency="true" frameborder="0" scrolling="0" width="110" height="20"></iframe> <br><a href="http://github.com/dwkd/QuickQuote/issues" target="_blank">Report an issue</a></div>');};a.appendChild(b);document.body.appendChild(a);},LoadMoreInfoPopover:function(b){var c=StockGenerator.CreateDOMElement("div","MoreInfoContainer");c.id="MoreInfoContainer";var a=StockGenerator.CreateDOMElement("div","MoreInfo",b);var d=StockGenerator.CreateDOMElement("div","closeInfo","x");d.onmouseover=function(){this.style.background="#333333";this.style.color="white";};d.onmouseout=function(){this.style.background="white";this.style.color="#999999";};d.onclick=function(){this.parentNode.parentNode.parentNode.removeChild(document.getElementById("MoreInfoContainer"));},a.appendChild(d);c.appendChild(a);document.body.appendChild(c);},CreateDOMElement:function(a,c,b){var d=document.createElement(a);if(typeof c!="undefined"){d.className=c;}if(typeof b!="undefined"){d.innerHTML=b;}return d;}};document.addEventListener("DOMContentLoaded",function(){StockGenerator.init();});